<!DOCTYPE html> <html lang="zh-CN" dir="ltr"> <head> <meta charset="UTF-8"> <!-- SEO --> <title>XPL - Nop</title> <meta property="og:title" content="XPL"> <meta name="description" content="XPL是一种采用XML语法格式，支持元编程、支持多种输出模式，与EL表达式（XScript脚本语言）紧密结合的一种模板语言。通过自定义标签，XPL可以引入新的语法结构，实现多种DSL的无缝嵌套。"> <meta property="og:description" content="XPL是一种采用XML语法格式，支持元编程、支持多种输出模式，与EL表达式（XScript脚本语言）紧密结合的一种模板语言。通过自定义标签，XPL可以引入新的语法结构，实现多种DSL的无缝嵌套。"> <meta name="keywords" content="Nop,Nop平台,Nop 平台,Nop Platform,Nop社区,Nop 社区,Nop Community,可逆计算,软件构造理论,低代码,lowcode,low-code,low code,低代码平台,lcdp,软件工程"> <link rel="canonical" href="https://nop-platform.gitee.io/projects/nop-entropy/docs/dev-guide/xlang/xpl/"> <meta property="og:url" content="https://nop-platform.gitee.io/projects/nop-entropy/docs/dev-guide/xlang/xpl/"> <meta property="og:site_name" content="Nop"> <script type="application/ld+json"> { "@context" : "http://schema.org", "@type" : "WebSite", "name" : "Nop", "url" : "https://nop-platform.gitee.io" } </script> <meta property="og:type" content="article"> <meta property="article:published_time" content="2024-04-13T09:39:39+08:00"> <link rel="next" href="https://nop-platform.gitee.io/projects/nop-entropy/docs/dev-guide/xlang/xscript/" title="XScript"> <link rel="prev" href="https://nop-platform.gitee.io/projects/nop-entropy/docs/dev-guide/xlang/xpath/" title=""> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "NewsArticle", "headline": "XPL", "image": null, "datePublished": "2024-04-13T09:39:39+08:00", "description": "XPL是一种采用XML语法格式，支持元编程、支持多种输出模式，与EL表达式（XScript脚本语言）紧密结合的一种模板语言。通过自定义标签，XPL可以引入新的语法结构，实现多种DSL的无缝嵌套。" } </script> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "Organization", "url": "https://nop-platform.gitee.io", "logo": "https://nop-platform.gitee.io/assets/logo-9952a8b58c6582fc86a9608db8113158fb31de7a9db19d4358ac7cb96578d34e.png" } </script> <link rel="author" href="https://nop-platform.gitee.io"> <!-- 页面渲染兼容性 --> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="renderer" content="webkit"> <meta name="viewport" content="width=device-width,initial-scale=1.0"> <meta name="theme-color" content="#0871ab"> <link rel="icon" href="/assets/logo-9952a8b58c6582fc86a9608db8113158fb31de7a9db19d4358ac7cb96578d34e.png"> <!-- 静态资源 --> <link type="text/css" rel="stylesheet" href="/assets/global-f979fafa22c865e727cd15f83cdc43dbc73c1a324d7ad4fe6fa48e275dc4c063.css"> <link type="text/css" rel="stylesheet" href="/assets/ksio/vendors/share-c2e41222f5f34b2de38cb5213fa0e439c11da73b3907b444a32635563ae85ffd.css"> <link type="text/css" rel="stylesheet" href="/assets/local/layouts/doc-c5c0ab8b12485893472e680b5f067b74e240481232265b6cb0ab6edc95c20f65.css"> <script type="text/javascript" src="/assets/global-b3a80dd53acf48ad7228d6fd741dba15d3845cbc3783bdbbf7244151a45628aa.js"></script> <!--[if lt IE 9]> <script type="text/javascript" src="/assets/ksio/support_ie8-e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.js"></script> <![endif]--> </head> <body class="Page" itemscope itemtype="http://schema.org/WebPage"> <header class="Page-header"> <div class="navbar navbar-static-top"> <div class="container-fluid"> <div class="navbar-header"> <button class="navbar-toggle collapsed" type="button" data-target=".Page-navs" data-toggle="collapse"> <span class="sr-only">Toggle navs</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/">Nop</a> </div> <!-- Nav menus --> <nav class="Page-navs navbar-collapse collapse"> <ul class="nav navbar-nav navbar-right"> <li class="dropdown"> <a class="dropdown-toggle" href="javascript:void(0);" data-toggle="dropdown">学习 <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a href="/projects/nop-entropy/docs/">指南</a> </li> <li><a href="https://www.zhihu.com/column/reversible-computation?utm_source=https://nop-platform.gitee.io&utm_medium=common-header" target="_blank" rel="external nofollow">文章</a> </li> <li><a href="https://space.bilibili.com/3493261219990250?utm_source=https://nop-platform.gitee.io&utm_medium=common-header" target="_blank" rel="external nofollow">视频</a> </li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" href="javascript:void(0);" data-toggle="dropdown">项目 <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a href="/projects/nop-entropy/">Nop Entropy</a> </li> <li><a href="/projects/nop-chaos/">Nop Chaos</a> </li> </ul> </li> <li class="dropdown"> <a class="dropdown-toggle" href="javascript:void(0);" data-toggle="dropdown">关于 <span class="caret"></span></a> <ul class="dropdown-menu"> <li><a href="/community/">社区</a> </li> <li><a href="/team/">团队</a> </li> <li><a href="https://gitee.com/nop-platform?utm_source=https://nop-platform.gitee.io&utm_medium=common-header" target="_blank" rel="external nofollow">Gitee 组织</a> </li> </ul> </li> <li><a href="https://nop-platform.github.io?utm_source=https://nop-platform.gitee.io&utm_medium=common-header" target="_blank" rel="external nofollow">English</a> </li> </ul> </nav> </div> </div> </header> <div class="Page-content"> <aside class="Page-aside"> <div class="AsideBrand"> <a href="/">Nop</a> </div> <nav class="AsideNav"><ul> <li> <a href="/projects/nop-entropy/docs/why-nop/">介绍</a> <ul> <li> <a href="/projects/nop-entropy/docs/">文档概览</a> </li> <li> <a href="/projects/nop-entropy/docs/tutorial/tutorial/">入门教程</a> <ul> <li> <a href="/projects/nop-entropy/docs/tutorial/simple/1-simple-service/">极简服务层开发</a> </li> <li> <a href="/projects/nop-entropy/docs/tutorial/simple/2-simple-dao/">极简数据访问层开发</a> </li> </ul> </li> <li> <a href="/projects/nop-entropy/docs/compare/">与其他平台的对比</a> </li> </ul> </li> <li> <a href="/projects/nop-entropy/docs/user-guide/">用户指南</a> <ul> <li> <a href="/projects/nop-entropy/docs/user-guide/installation/">安装和配置</a> </li> <li> <a href="/projects/nop-entropy/docs/user-guide/report/">报表引擎</a> </li> <li> <a href="/projects/nop-entropy/docs/user-guide/idea/idea-plugin/">IDEA插件使用</a> </li> <li> <a href="/projects/nop-entropy/docs/user-guide/monitor/grafana/">监控</a> </li> </ul> </li> <li> <a href="/projects/nop-entropy/docs/arch/">软件架构</a> <ul> <li> <a href="/projects/nop-entropy/docs/arch/module-dependency/">模块依赖关系</a> </li> <li> <a href="/projects/nop-entropy/docs/core-code-guidance/">核心代码阅读导引</a> </li> </ul> </li> <li> <a href="/projects/nop-entropy/docs/theory/">理论基础</a> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/">开发指南</a> <ul> <li> <a href="/projects/nop-entropy/docs/dev-guide/codegen/">代码生成器</a> <ul> <li> <a href="/projects/nop-entropy/docs/dev-guide/cli/">命令行工具</a> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/command/command/">命令行开发支持</a> </li> </ul> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/config/">配置管理</a> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/ioc/">IoC容器</a> <ul> <li> <a href="/projects/nop-entropy/docs/dev-guide/ioc/aop/">AOP支持</a> </li> </ul> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/orm/">ORM框架</a> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/xlang/">XLang语言</a> <ul> <li> <a href="/projects/nop-entropy/docs/dev-guide/xlang/xdef/">XDef元模型</a> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/xlang/xdsl/">XDSL领域语言</a> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/xlang/xscript/">XScript脚本语言</a> </li> <li> <a class="is-selected" href="/projects/nop-entropy/docs/dev-guide/xlang/xpl/">Xpl模板语言</a> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/xlang/meta-programming/">元编程</a> </li> </ul> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/model/">Excel模型</a> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/graphql/">GraphQL引擎</a> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/microservice/">分布式微服务</a> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/rule/rule/">规则引擎</a> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/workflow/task-flow/">逻辑编排</a> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/autotest/">自动化测试</a> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/tenant/">多租户</a> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/delta/delta-customization/">Delta定制</a> <ul> <li> <a href="/projects/nop-entropy/docs/dev-guide/vfs/">Delta文件系统</a> </li> </ul> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/auth/">权限配置</a> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/biz/">业务规则</a> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/nocode/">动态模型</a> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/xui/">前端模型</a> </li> </ul> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/integration/">第三方集成</a> <ul> <li> <a href="/projects/nop-entropy/docs/dev-guide/spring/">spring集成</a> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/quarkus/">quarkus集成</a> </li> </ul> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/ide/idea/">IDEA插件</a> <ul> <li> <a href="/projects/nop-entropy/docs/dev-guide/ide/plugin-dev/">插件开发</a> </li> </ul> </li> <li> <a href="/projects/nop-entropy/docs/faq/faq/">常见问题</a> <ul> <li> <a href="/projects/nop-entropy/docs/faq/debug-errors/">错误诊断</a> </li> <li> <a href="/projects/nop-entropy/docs/dev-guide/recipe/">常见问题解决方案</a> </li> </ul> </li> </ul> </nav> </aside> <main class="Page-main"> <article class="Article container-fluid"> <header class="Article-header"> <h1 class="Article-title">XPL</h1> </header> <div class="Article-content col-md-9"><p>XPL是一种采用XML语法格式，支持元编程、支持多种输出模式，与EL表达式（XScript脚本语言）紧密结合的一种模板语言。通过自定义标签，XPL可以引入新的语法结构， 实现多种DSL的无缝嵌套。</p> <h2 id="section">内置标签</h2> <p>XPL内置的标签提供了判断、循环、导入、宏处理等基本功能。</p> <h3 id="section-1">控制逻辑</h3> <ul> <li><code>&lt;c:if&gt;</code> 判断语句。</li> </ul> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">&quot;${cond}&quot;</span><span class="nt">&gt;</span>
  当条件为真时执行。
<span class="nt">&lt;/c:if&gt;</span></code></pre></figure> <ul> <li><code>&lt;c:for&gt;</code> 循环语句。 <code>index</code>对应循环下标</li> </ul> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;c:for</span> <span class="na">items=</span><span class="s">&quot;${list}&quot;</span> <span class="na">var=</span><span class="s">&quot;item&quot;</span> <span class="na">index=</span><span class="s">&quot;index&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/c:for&gt;</span>

<span class="nt">&lt;c:for</span> <span class="na">begin=</span><span class="s">&quot;0&quot;</span> <span class="na">end=</span><span class="s">&quot;2&quot;</span> <span class="na">var=</span><span class="s">&quot;index&quot;</span> <span class="na">index=</span><span class="s">&quot;index&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/c:for&gt;</span></code></pre></figure> <ul> <li><code>&lt;c:while&gt;</code> while循环语句。</li> </ul> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;c:while</span> <span class="na">test=</span><span class="s">&quot;${cond}&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/c:while&gt;</span></code></pre></figure> <ul> <li> <p><code>&lt;c:break&gt;</code> 跳出循环语句</p> </li> <li> <p><code>&lt;c:continue&gt;</code> 类似于java中的<code>continue</code>语句，跳过本次循环。</p> </li> <li> <p><code>&lt;c:return&gt;</code> 从自定义标签返回，可以通过<code>value</code>属性指定返回值.</p> </li> </ul> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;c:return</span> <span class="na">value=</span><span class="s">&quot;${result}&quot;</span> <span class="nt">/&gt;</span></code></pre></figure> <ul> <li><code>&lt;c:choose&gt;</code> 多重选择语句。</li> </ul> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;c:choose&gt;</span>
   <span class="nt">&lt;when</span> <span class="na">test=</span><span class="s">&quot;${cond}&quot;</span><span class="nt">&gt;</span>
      当条件为true时执行
   <span class="nt">&lt;/when&gt;</span>
   <span class="nt">&lt;otherwise&gt;</span>
      当其他条件都不满足时执行
   <span class="nt">&lt;/otherwise&gt;</span>
 <span class="nt">&lt;/c:choose&gt;</span></code></pre></figure> <ul> <li><code>&lt;c:throw&gt;</code></li> </ul> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;c:throw</span> <span class="na">errorCode=</span><span class="s">&quot;xxx.yyy.zz&quot;</span> <span class="na">params=</span><span class="s">&quot;${{a:1,b:2}}&quot;</span> <span class="nt">/&gt;</span></code></pre></figure> <ul> <li><code>&lt;c:try&gt;</code></li> </ul> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;c:try&gt;</span>
  <span class="nt">&lt;body&gt;</span>
  需要执行的代码
  <span class="nt">&lt;/body&gt;</span>

  <span class="nt">&lt;catch&gt;</span>
     捕获异常，上下文中$excetion对应异常对象
  <span class="nt">&lt;/catch&gt;</span>

  <span class="nt">&lt;finally&gt;</span>

  <span class="nt">&lt;/finally&gt;</span>
<span class="nt">&lt;/c:try&gt;</span></code></pre></figure> <h3 id="section-2">输出</h3> <ul> <li> <p><code>&lt;c:collect&gt;</code></p> </li> <li> <p><code>&lt;c:print&gt;</code></p> </li> <li> <p><code>&lt;c:out&gt;</code></p> </li> </ul> <h3 id="section-3">脚本语言</h3> <ul> <li><code>&lt;c:script&gt;</code> 嵌入脚本语言，可以用<code>lang</code>属性来指定使用不同的脚本引擎，例如<code>groovy</code>等，缺省是<code>xlang</code></li> </ul> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;c:script</span> <span class="na">lang=</span><span class="s">&quot;groovy&quot;</span><span class="nt">&gt;</span>
  代码
<span class="nt">&lt;/c:script&gt;</span></code></pre></figure> <h3 id="section-4">编译期</h3> <ul> <li><code>&lt;c:import&gt;</code> 导入常量类或者标签库</li> </ul> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;c:import</span> <span class="na">from=</span><span class="s">&quot;a/b.xlib&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;c:import</span> <span class="na">class=</span><span class="s">&quot;a.b.c.MyConstants&quot;</span> <span class="nt">/&gt;</span></code></pre></figure> <p>引入标签库的时候缺省名字空间根据标签库文件名推定，例如 <code>a.xlib =&gt; a</code>, <code>a!ext.xlib =&gt; a</code>。 也可以直接指定名字空间，例如</p> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;c:import</span> <span class="na">from=</span><span class="s">&quot;xxx.xlib&quot;</span> <span class="na">as=</span><span class="s">&quot;yyy&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;yyy:MyTag/&gt;</span></code></pre></figure> <ul> <li> <p><code>&lt;c:include&gt;</code></p> </li> <li> <p><code>&lt;macro:script&gt;</code> 编译指定内容, 并直接运行</p> </li> <li> <p><code>&lt;macro:gen&gt;</code> 宏标签会在编译期被运行。</p> </li> </ul> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;macro:gen</span> <span class="na">xpl:dump=</span><span class="s">&quot;true&quot;</span> <span class="nt">&gt;</span>
    这里的内容先被编译为Expression, 然后在编译期会立刻执行此xpl。
    xpl输出的XNode会再次被编译
  <span class="nt">&lt;/macro:gen&gt;</span></code></pre></figure> <h3 id="section-5">其他</h3> <ul> <li><code>&lt;c:unit&gt;</code> 一个仅起分组作用的虚拟标签。它的直接编译结果为空。</li> </ul> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;c:unit&gt;</span>
      <span class="nt">&lt;div/&gt;</span>
      <span class="nt">&lt;input/&gt;</span>
   <span class="nt">&lt;/c:unit&gt;</span>

   <span class="c">&lt;!-- 等价于 --&gt;</span>
   <span class="nt">&lt;div/&gt;</span>
   <span class="nt">&lt;input/&gt;</span></code></pre></figure> <ul> <li><code>&lt;c:log&gt;</code> 只有<code>io.nop.xpl.logger</code>的对应log级别打开时，才拼接日志消息并打印日志。</li> </ul> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;c:log</span> <span class="na">info=</span><span class="s">&quot;xxx ${myvar} ${myObj.func(3)} sss&quot;</span> <span class="nt">/&gt;</span></code></pre></figure> <h2 id="section-6">自定义标签</h2> <h3 id="section-7">条件标签</h3> <p>当自定义标签的<code>conditionTag</code>设置为<code>true</code>时为条件标签</p> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="c">&lt;!-- 标签定义 --&gt;</span>
  <span class="nt">&lt;WhenAdmin</span> <span class="na">conditionTag=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;source&gt;</span>
      <span class="nt">&lt;c:script&gt;</span>
        $userContext.isUserInRole(&#39;admin&#39;)
      <span class="nt">&lt;/c:script&gt;</span>
    <span class="nt">&lt;/source&gt;</span>
  <span class="nt">&lt;/WhenAdmin&gt;</span>

  <span class="c">&lt;!-- 作为条件容器调用 --&gt;</span>
  <span class="nt">&lt;biz:WhenAdmin&gt;</span>
    当用户具有admin角色时执行这里的内容
  <span class="nt">&lt;/biz:WhenAdmin&gt;</span></code></pre></figure> <p>条件标签可以直接作为<code>c:choose</code>的分支</p> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;c:choose&gt;</span>
    <span class="nt">&lt;biz:WhenAdmin&gt;</span>
    <span class="nt">&lt;/biz:WhenAdmin&gt;</span>

    <span class="nt">&lt;c:otherwise&gt;</span>

    <span class="nt">&lt;/c:otherwise&gt;</span>
  <span class="nt">&lt;/c:choose&gt;</span></code></pre></figure> <h2 id="section-8">动态属性</h2> <ul> <li>如果属性值返回<code>null</code>, 则该属性在输出时会被自动忽略。</li> </ul> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">&quot;${null}&quot;</span> <span class="nt">/&gt;</span>

  <span class="c">&lt;!-- 实际输出 --&gt;</span>
  <span class="nt">&lt;input</span> <span class="nt">/&gt;</span></code></pre></figure> <ul> <li><code>xpl:attrs</code>可以指定一个Map, 批量输出一组动态属性。如果属性值为<code>null</code>, 一样不输出</li> </ul> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;input</span> <span class="na">xpl:attrs=</span><span class="s">&quot;{name:&#39;a&#39;,class:null}&quot;</span> <span class="nt">/&gt;</span>

  <span class="c">&lt;!-- 实际输出 --&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;a&quot;</span> <span class="nt">/&gt;</span></code></pre></figure> <p>另外，需要注意，如果节点上已经存在某属性，则<code>xpl:attrs</code>指定的属性将会被忽略</p> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;x&quot;</span> <span class="na">xpl:attrs=</span><span class="s">&quot;{name:&#39;b&#39;}&quot;</span> <span class="nt">/&gt;</span>

  <span class="c">&lt;!-- 实际输出  --&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">&quot;x&quot;</span> <span class="nt">/&gt;</span></code></pre></figure> <h2 id="section-9">输出模式</h2> <p>xpl标签既有返回值，又有输出。输出具有多种模式</p> <ul> <li><code>none</code> 不允许输出文本</li> <li><code>html</code> 输出html文本，自动识别<code>&lt;script&gt;</code>、<code>&lt;div&gt;</code>等需要使用完整封闭形式的标签</li> <li><code>xml</code> 输出xml文本，如果<code>xpl:allowUnknownTag</code>为<code>true</code>, 则未识别的所有带名字空间的标签也会被输出</li> <li><code>text</code> 不能输出xml标签，但是可以输出文本内容，而且输出的文本不会进行xml转义</li> <li><code>node</code> 所有输出的内容自动被转化为<code>XNode</code>。</li> </ul> <ol> <li>定义标签库时，可以通过在根结点上标记<code>defaultOutputMode</code>来设置本库中标签的缺省输出模式。</li> <li>也可以在定义每个自定义标签时指定<code>outputMode</code></li> <li>在调用标签时，可以通过<code>xpl:outputMode</code>来设置未识别的标签的输出模式。如果自定义标签已经有自己的输出模式，则外部调用时再设置也是无效的。</li> </ol> <h2 id="thislib">thisLib</h2> <p>在自定义标签库中，可以使用<code>thisLib</code>来指向当前标签库。 例如在<code>web.xlib</code>中， <code>&lt;thisLib:LoadPage&gt;</code>对应于 <code>&lt;web:LoadPage xpl:lib="/nop/web/xlib/web.xlib"&gt;</code></p> <p>引入<code>thisLib</code>这个特殊的名字空间的原因在于，外部引用标签库的时候有可能通过<code>as</code>来修改最终使用时的名字空间。例如</p> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;c:import</span> <span class="na">from=</span><span class="s">&quot;/nop/web/xlib/web.xlib&quot;</span> <span class="na">as=</span><span class="s">&quot;myweb&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;myweb:GenPage</span> <span class="na">page=</span><span class="s">&quot;xx&quot;</span> <span class="nt">/&gt;</span></code></pre></figure> <h2 id="slot">slot机制</h2> <p>xpl模板标签的slot机制类似于Vue组件中的slot机制。</p> <h3 id="slot-1">1. 在标签库中定义标签时声明slot</h3> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="c">&lt;!-- /test/my-ext.xlib --&gt;</span>
<span class="nt">&lt;lib</span> <span class="na">x:schema=</span><span class="s">&quot;/nop/schema/xlib.xdef&quot;</span> <span class="na">xmlns:x=</span><span class="s">&quot;/nop/schema/xdsl.xdef&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;tags&gt;</span>
        <span class="nt">&lt;MyTagExt</span> <span class="na">outputMode=</span><span class="s">&quot;xml&quot;</span><span class="nt">&gt;</span>
            <span class="c">&lt;!-- 声明一个名称为ext的slot --&gt;</span>
            <span class="nt">&lt;slot</span> <span class="na">name=</span><span class="s">&quot;ext&quot;</span> <span class="nt">&gt;</span>
                <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">&quot;x&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/slot&gt;</span>

            <span class="nt">&lt;source&gt;</span>
                <span class="nt">&lt;c:unit</span> <span class="na">xpl:slot=</span><span class="s">&quot;ext&quot;</span> <span class="na">xpl:slotArgs=</span><span class="s">&quot;{x:3}&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/source&gt;</span>
        <span class="nt">&lt;/MyTagExt&gt;</span>
    <span class="nt">&lt;/tags&gt;</span>
<span class="nt">&lt;/lib&gt;</span></code></pre></figure> <ul> <li>在标签实现中通过<code>xpl:slot</code>属性来引用外部传入的slot实现，通过<code>xpl:slotArgs</code>向slot传递参数。具体能够传递哪些参数需要在slot定义时指定</li> <li><code>xpl:slot</code>可以标记在任何标签上，并不是只能标记在<code>c:unit</code>标签上。与vue的slot类似，当<code>xpl:slot</code>指定的slot不存在时，会继续执行该标签，否则会用slot替换该标签。 也就是说<code>xpl:slot</code>所在的标签相当于是提供了slot的缺省值。</li> </ul> <h3 id="slot-2">2. 调用标签时指定slot</h3> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;my-ext:MyTagExt</span> <span class="na">xpl:lib=</span><span class="s">&quot;/test/my-ext.xlib&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ext</span> <span class="na">xpl:slotScope=</span><span class="s">&quot;x&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;x&gt;</span>${x}<span class="nt">&lt;/x&gt;</span>
  <span class="nt">&lt;/ext&gt;</span>
<span class="nt">&lt;/my-ext:MyTagExt&gt;</span></code></pre></figure> <ul> <li>调用标签时通过<code>xpl:slotScope</code>来引入<code>xpl:slotArgs</code>传入的参数，此时可以利用javascript的解构语法来给变量重命名。</li> <li>如果不写<code>xpl:slotScope</code>，实际上仍然可以访问到<code>xpl:slotArgs</code>传入的参数</li> <li>slot编译为一个函数 slot_{name}, <code>xpl:slotArgs</code>就是向这个函数传递的参数，必须是一个Map。而在标签调用时指定的<code>xpl:slotScope</code>相当于是声明这个函数的参数列表，此时可以重命名参数</li> </ul> <p>换句话说：</p> <ol> <li>slot是将调用方的body内容，放入实现方的<code>xpl:slot</code>位置</li> <li>slotArgs 是实现方向调用方传递的参数，在调用方的body中，可以使用这些参数</li> <li>调用方可以使用<code>xpl:slotScope</code> 来明确引入实现方的参数，同时可以重命名</li> </ol> <h3 id="slottypenode">3. 指定slotType=node</h3> <p>缺省情况下slot的类型为renderer，编译为一个函数，这个函数的输出模式可以在slot上指定outputMode来定制。除了编译为函数之外，还可以将指定slotType=node，此时 slot就保持XNode节点形式直接传入，而不会被转化为函数。此时也不能通过<code>xpl:slot="slotName"</code>来调用这个slot。</p> <p>一般使用<code>renderType=node</code>都是将传入的节点作为模型对象或者元数据来使用，特别是结合编译期宏标签机制，可以实现不同的DSL无缝嵌套在一起。</p> <p>例如biz.xlib中Validator标签</p> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;Validator</span> <span class="na">ignoreUnknownAttrs=</span><span class="s">&quot;true&quot;</span> <span class="na">macro=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!--</span>
<span class="c">    runtime标识是运行期存在的变量。这个属性仅当标签是宏标签的时候起作用</span>
<span class="c">    --&gt;</span>
    <span class="nt">&lt;attr</span> <span class="na">name=</span><span class="s">&quot;obj&quot;</span> <span class="na">defaultValue=</span><span class="s">&quot;$scope&quot;</span> <span class="na">runtime=</span><span class="s">&quot;true&quot;</span> <span class="na">optional=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- slotType=node表示保持XNode节点内容传入到source段中。如果不设置这个属性，则会编译后传入 --&gt;</span>
    <span class="nt">&lt;slot</span> <span class="na">name=</span><span class="s">&quot;default&quot;</span> <span class="na">slotType=</span><span class="s">&quot;node&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;source&gt;</span>
        <span class="c">&lt;!-- 在编译期解析标签体得到ValidatorModel, 保存为编译期的变量validatorModel --&gt;</span>
        <span class="nt">&lt;c:script&gt;</span><span class="cp">&lt;![CDATA[</span>
<span class="cp">           import io.nop.xlang.filter.BizValidatorHelper;</span>

<span class="cp">            let validatorModel = BizValidatorHelper.parseValidator(slot_default);</span>
<span class="cp">            ...返回编译得到的Expression对象</span>
<span class="cp">        ]]&gt;</span><span class="nt">&lt;/c:script&gt;</span>
    <span class="nt">&lt;/source&gt;</span>
<span class="nt">&lt;/Validator&gt;</span></code></pre></figure> <ul> <li>slot的<code>name=default</code>和<code>slotType=node</code>表示调用时整个标签的body作为XNode类型的节点对象，名称为slot_default</li> <li>Validator标签的<code>macro=true</code> 表示它是宏标签。它的source段在编译期会运行，输出的结果是一个表达式对象，然后再对该表达式对象进行编译。 宏标签相当于是一种内嵌的代码生成器</li> </ul> <p>调用时</p> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;biz:Validator</span> <span class="na">xpl:lib=</span><span class="s">&quot;/nop/core/xlib/biz.xlib&quot;</span> <span class="na">fatalSeverity=</span><span class="s">&quot;100&quot;</span>
               <span class="na">obj=</span><span class="s">&quot;${entity}&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;check</span> <span class="na">id=</span><span class="s">&quot;checkTransferCode&quot;</span> <span class="na">errorCode=</span><span class="s">&quot;test.not-transfer-code&quot;</span>
           <span class="na">errorDescription=</span><span class="s">&quot;扫入的码不是流转码&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;eq</span> <span class="na">name=</span><span class="s">&quot;flowMode&quot;</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/check&gt;</span>
<span class="nt">&lt;/biz:Validator&gt;</span></code></pre></figure> <p>这里<code>&lt;biz:Validator&gt;</code>内部嵌套的实际是<code>validator.xdef</code>元模型所定义的验证专用的DSL</p> <h2 id="xpl">xpl专用属性</h2> <p>XPL内置了一些通用属性，所有标签都可以指定这些属性。xpl属性的处理顺序为 <code>xpl:enableNs</code> –&gt; <code>xpl:disableNs</code> –&gt; <code>xpl:attrs</code> -&gt; <code>xpl:frame</code> -&gt; <code>xpl:decorator</code> --&gt; <code>xpl:lib</code> –&gt; <code>xpl:outputMode</code> –&gt; <code>xpl:is</code> –&gt; <code>xpl:invert</code> –&gt; <code>xpl:return</code> --&gt; <code>xpl:if</code></p> <ol> <li><code>xpl:disableNs</code>/<code>xpl:enableNs</code> <code>xpl:disableNs</code> 忽略指定的名字空间，不把它们看作是xpl标签库中的标签 <code>xpl:enableNs</code> 取消<code>xpl:ignoreNs</code>的作用，恢复识别指定名字空间对应的标签库</li> </ol> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="c">&lt;!-- c:if标签不会被解析，而是作为文本被直接输出 --&gt;</span>
  <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">&quot;${x}&quot;</span> <span class="na">xpl:ignoreNs=</span><span class="s">&quot;*&quot;</span><span class="nt">&gt;</span>
     <span class="c">&lt;!-- 子节点也不会被解析--&gt;</span>
     <span class="nt">&lt;my:MyTag&gt;</span>
         <span class="c">&lt;!--  通过xpl:ignoreTag=false恢复对标签的解析 --&gt;</span>
         <span class="nt">&lt;c:if</span> <span class="na">test=</span><span class="s">&quot;${xx}&quot;</span> <span class="na">xpl:checkNs=</span><span class="s">&quot;*&quot;</span><span class="nt">&gt;</span>
            ...
         <span class="nt">&lt;/c:if&gt;</span>
     <span class="nt">&lt;/my:MyTag&gt;</span>
  <span class="nt">&lt;/c:if&gt;</span></code></pre></figure> <ol> <li><code>xpl:ignoreExpr</code> 是否识别表达式。如果设置为<code>true</code>，则非自定义标签中用到的EL表达式将被作为文本直接输出。</li> </ol> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;div</span> <span class="na">xpl:ignoreExpr=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
  ${这个表达式不会被解析}
<span class="nt">&lt;/div&gt;</span></code></pre></figure> <ol> <li><code>xpl:is</code> 可以改变识别的xpl标签名</li> </ol> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;div</span> <span class="na">xpl:is=</span><span class="s">&quot;my:MyTag&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="c">&lt;!-- 等价于 --&gt;</span>
<span class="nt">&lt;my:MyTag&gt;</span>
<span class="nt">&lt;/my:MyTag&gt;</span></code></pre></figure> <ol> <li><code>xpl:if</code> 控制标签是否运行，相当于简化<code>c:if</code>调用</li> </ol> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;div</span> <span class="na">xpl:if=</span><span class="s">&quot;selectors.contains(&#39;a&#39;)&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="c">&lt;!-- 如果使用编译期表达式，xpl引擎内部会实现自动优化 --&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">xpl:if=</span><span class="s">&quot;#{myVar}&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span></code></pre></figure> <ol> <li><code>xpl:skipIf</code> 如果为<code>true</code>, 则跳过本层标签，直接编译标签的<code>body</code>。相当于是控制跳过嵌套的层次</li> </ol> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;my:MyTag</span> <span class="na">xpl:skipIf=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
     <span class="nt">&lt;body/&gt;</span>
  <span class="nt">&lt;/my:MyTag&gt;</span>

  <span class="c">&lt;!-- 等价于 --&gt;</span>
  <span class="nt">&lt;body/&gt;</span></code></pre></figure> <ol> <li> <p><code>xpl:allowUnknownTag</code> 是否允许未识别的带名字空间的标签。缺省为<code>false</code>, 当带名字空间的标签不能被识别为自定义标签时，会抛出异常。</p> </li> <li> <p><code>xpl:outputMode</code> 设置xpl编译器的输出模式。注意，在<code>c:macro</code>和<code>x:extends</code>运行期间，缺省设置了<code>xpl:outputMode=node</code></p> </li> <li> <p><code>xpl:lib</code> 在局部范围内引入标签库。当超出标签范围后，引入的标签库不可见。</p> </li> </ol> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;my:MyTag</span> <span class="na">xpl:lib=</span><span class="s">&quot;my.xlib&quot;</span> <span class="nt">/&gt;</span>

 <span class="c">&lt;!-- xpl:lib引入的标签库仅对当前节点有效，对这里的节点不可见，因此编译时会报错 --&gt;</span>
 <span class="nt">&lt;my:MyTag</span> <span class="nt">/&gt;</span></code></pre></figure> <ol> <li><code>xpl:return</code> 执行完标签后将把返回值设置为指定变量</li> </ol> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;my:MyTag</span>  <span class="na">xpl:return=</span><span class="s">&quot;x&quot;</span><span class="nt">&gt;</span>
    此标签的执行结果被保存到变量x。相当于 let x = #[my:MyTag()]
  <span class="nt">&lt;/my:MyTag&gt;</span></code></pre></figure> <ol> <li><code>xpl:invert</code> 对于返回<code>boolean</code>值的自定义标签，<code>xpl:invert</code>表示对返回值取反。</li> </ol> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;biz:WhenAdmin&gt;</span>
    当具有admin角色的时候执行这里的内容
  <span class="nt">&lt;/biz:WhenAdmin&gt;</span>

  <span class="nt">&lt;biz:WhenAdmin</span> <span class="na">xpl:invert=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
     当【不具有】admin角色的时候执行这里的内容
  <span class="nt">&lt;/biz:WhenAdmin&gt;</span></code></pre></figure> <h2 id="decorator">装饰器decorator</h2> <p>任何标签都支持名为<code>&lt;xpl:decorator&gt;</code>的装饰子节点, 它可以将嵌套结构变换为线性结构。</p> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;div&gt;</span>
 <span class="nt">&lt;xpl:decorator&gt;</span>
   <span class="nt">&lt;test:MyTag</span> <span class="na">a=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
   <span class="nt">&lt;test:MyTag2&gt;</span>
      <span class="nt">&lt;xpl:decorated/&gt;</span>
      <span class="nt">&lt;child/&gt;</span>
   <span class="nt">&lt;/test:MyTag2&gt;</span>
 <span class="nt">&lt;/xpl:decorator&gt;</span>

 content
<span class="nt">&lt;/div&gt;</span>

<span class="c">&lt;!-- 等价于 --&gt;</span>
<span class="nt">&lt;test:MyTag</span> <span class="na">a=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;test:MyTag2&gt;</span>
     <span class="nt">&lt;div</span> <span class="nt">&gt;</span>
      content
     <span class="nt">&lt;/div&gt;</span>
     <span class="nt">&lt;child/&gt;</span>
  <span class="nt">&lt;/test:MyTag2&gt;</span>
<span class="nt">&lt;/test:MyTag&gt;</span></code></pre></figure> <h2 id="xpl-1">Xpl模板语言的意义</h2> <p>xpl模板语言是XLang语言家族中的关键性成员，它的设计超越了现在所有的开源模板语言，特别是为元编程补充了大量语法特性。在XScript脚本语言中可以通过</p> <figure class="highlight"><pre><code class="language-js" data-lang="js"><span></span><span class="kd">let</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">xpl</span> <span class="sb">`&lt;c:if&gt;&lt;/c:if&gt;`</span></code></pre></figure> <p>这种方式嵌入xpl模板语言，而在Xpl模板语言中，也可以用 <code>&lt;c:script&gt;</code>来嵌入脚本语言，并且可以通过各种自定义标签嵌入不同语义和形式的DSL语言。</p> <p>Xpl模板语言可以设置不同的输出模式，当输出模式为xjson时，可以将xml输出自动转化为json对象，因此我们可以用XML格式来编写AMIS页面</p> <figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span></span><span class="nt">&lt;form</span> <span class="na">name=</span><span class="s">&quot;a&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;crud</span> <span class="na">name=</span><span class="s">&quot;list&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;api</span> <span class="na">url=</span><span class="s">&quot;xxx&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/crud&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/form&gt;</span></code></pre></figure> <p>各种逻辑结构的形式边界在xpl模板语言中可以被很自然的消解，这才是最关键的部分。</p> </div> <footer class="Article-footer col-md-3"> <div class="Widget"> <div class="Widget-body"><a href="https://gitee.com/canonical-entropy/nop-entropy/edit/master/docs/dev-guide/xlang/xpl.md" target="_blank" rel=" rel="external nofollow"">在 Gitee 上编辑文档内容</a></div> </div> <section class="Widget Widget--toc"> <div class="Widget-header"> <h2 class="Widget-title">目录</h2> </div> <div class="Widget-body"></div> </section> </footer> </article> <footer class="Page-footer Footer"> <div class="container-fluid"> <div class="Footer-description"> <!-- Important links --> <nav class="Footer-navs"> <ul><li><a href="/projects/nop-entropy/docs/"><span>指南</span></a> </li><li><a href="/community/"><span>社区</span></a> </li></ul> </nav> <!-- Copyright --> <div class="Footer-copyright"> <p>&copy; 2024 <a href="https://nop-platform.gitee.io?utm_source=https://nop-platform.gitee.io&utm_medium=common-footer" target="_blank" rel="external nofollow">Nop 社区</a> 版权所有 </p> </div> </div> </div> </footer> </main> </div> <script>$('table').addClass('table table-bordered')</script> <script type="text/javascript" src="/assets/ksio/vendors/share.min-3155ee636b84a04d036e0f1ba833227d3fd03a4c58a6f2e21c9ceb1c5d0198c7.js"></script><script type="text/javascript" src="/assets/ksio/components-a266f21fe1dfd61bebf40e74872cbf901eb3e201f7d33e9e5d5af9a55f4b24ea.js"></script> <script type="text/javascript" src="/assets/ksio/initializers/time-8d7a529a66ae6cb53c2283d21fd6a12c538b8473dd5bd76458366d09adce7bf6.js"></script><script type="text/javascript" src="/assets/ksio/initializers/lazyload-44b7df8a9282d598284d522e64d6be9ac88d466f3c4a734a514303e99347b2c9.js"></script> </body> </html>
